<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Watch Party</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.11.8/video-js.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        input, button { padding: 10px; margin: 5px; }
        video { width: 80%; }
    </style>
</head>
<body>
    <h1>Watch Movie Together</h1>

    <input type="text" id="tmdbId" placeholder="Enter TMDB Movie ID">
    <button onclick="fetchMovie()">Load Movie</button>

    <br><br>
    
    <!-- Video Player -->
    <video id="videoPlayer" class="video-js vjs-default-skin" controls></video>

    <br><br>
    
    <input type="number" id="syncTime" placeholder="Enter Time (seconds)">
    <button onclick="syncVideo()">Sync Video</button>

    <!-- Firebase & Video.js -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/7.11.8/video.min.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBWNDZLIqkLSQUdswT-2H-jr-0Dg2gvuik",
            authDomain: "private-watch-party.firebaseapp.com",
            projectId: "private-watch-party",
            storageBucket: "private-watch-party.firebasestorage.app",
            messagingSenderId: "36283139121",
            appId: "1:36283139121:web:cff1ed864b7349061c0110",
            databaseURL: "https://private-watch-party-default-rtdb.asia-southeast1.firebasedatabase.app"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let videoTimeRef = db.ref("videoTime");

        // Initialize Video.js player
        let player = videojs('videoPlayer');

        function fetchMovie() {
            const tmdbId = document.getElementById("tmdbId").value;
            if (!tmdbId) {
                alert("Please enter a TMDB ID.");
                return;
            }

            const apiUrl = `https://www.2embed.cc/embed/movie/tmdb/${tmdbId}`;

            fetch(apiUrl)
                .then(response => response.json()) 
                .then(data => {
                    if (data.stream_url) {
                        player.src({ src: data.stream_url, type: 'application/x-mpegURL' });
                        player.play();
                    } else {
                        alert("No stream found!");
                    }
                })
                .catch(error => console.error("Error fetching movie:", error));
        }

        function syncVideo() {
            const syncTime = document.getElementById("syncTime").value;
            if (syncTime) {
                videoTimeRef.set(syncTime);
                alert("Syncing time: " + syncTime + " seconds.");
            }
        }

        // Listen for time sync updates from Firebase
        videoTimeRef.on('value', (snapshot) => {
            const time = snapshot.val();
            if (time !== null) {
                player.currentTime(time);
            }
        });
    </script>
</body>
</html>
